[
  {
    "milestone": 1,
    "goal": "pnpm workspace + Next.js App Router プロジェクトが起動し、Biome lint / typecheck / build が通り、shadcn/ui + Tailwind CSS でレイアウト（サイドバー + ヘッダー）が表示され、Prisma スキーマに全テーブルが定義されて prisma generate が成功する",
    "verification": "pnpm lint && pnpm typecheck && pnpm build",
    "done": true,
    "tasks": [
      {
        "id": "project-scaffold",
        "description": "pnpm workspace + Next.js App Router プロジェクトの初期構築。ルート package.json（workspace scripts: lint, typecheck, build）、pnpm-workspace.yaml、apps/content-reviewer/ 配下に package.json・next.config.ts・tsconfig.json・tailwind.config.ts・postcss.config.mjs・biome.json を作成し、Tailwind CSS v4 + PostCSS を設定、apps/content-reviewer/src/app/globals.css に Tailwind ディレクティブを記述、最小限の app/layout.tsx と app/page.tsx で pnpm build が通る状態にする",
        "wave": 1,
        "done": true
      },
      {
        "id": "shadcn-ui-setup",
        "description": "apps/content-reviewer/ で shadcn/ui を初期化し、components.json を生成。lib/utils.ts に cn() ヘルパーを作成。レイアウトに必要な shadcn/ui コンポーネント（Button, Sheet, Separator, Sidebar 系）を components/ui/ に追加する",
        "wave": 2,
        "done": true
      },
      {
        "id": "prisma-schema",
        "description": "apps/content-reviewer/prisma/schema.prisma に全 7 テーブル（users, content_checks, content_segments, check_results, expression_rules, knowledge_articles, knowledge_embeddings）を定義。pgvector 拡張の有効化、全リレーション・インデックス・enum（source, status, check_type, severity, source_type）を含め、prisma generate が成功する状態にする",
        "wave": 2,
        "done": true
      },
      {
        "id": "app-layout-shell",
        "description": "apps/content-reviewer/src/app/layout.tsx にルートレイアウトを実装。shadcn/ui の Sidebar コンポーネントを使ったサイドバー（ナビゲーション: ダッシュボード, チェック実行, 表現ルール, ナレッジ）+ ヘッダー（アプリ名表示）のシェル UI を components/layout/ 配下に作成（sidebar-nav.tsx, header.tsx, app-shell.tsx）し、レスポンシブ対応する",
        "wave": 3,
        "done": true
      },
      {
        "id": "stub-pages",
        "description": "全ルートのスタブページを作成: app/page.tsx（ダッシュボード）、app/login/page.tsx、app/checks/new/page.tsx、app/checks/[id]/page.tsx、app/rules/page.tsx、app/knowledge/page.tsx、app/knowledge/import/page.tsx。各ページはページタイトルのみ表示する Server Component とし、app-shell レイアウトでラップされた状態にする",
        "wave": 3,
        "done": true
      },
      {
        "id": "verify-milestone1",
        "description": "pnpm lint && pnpm typecheck && pnpm build を実行し全て成功することを確認。prisma generate が成功することを確認。Biome lint エラー・TypeScript 型エラー・ビルドエラーがあれば全て修正する",
        "wave": 4,
        "done": true
      }
    ]
  },
  {
    "milestone": 2,
    "goal": "Supabase Auth による Google OAuth ログイン・ログアウトが動作し、未認証時は /login にリダイレクトされ、開発環境（NODE_ENV=development）では認証スキップでダミーユーザーとしてダッシュボード（空の / ページ）にアクセスできる",
    "verification": "pnpm lint && pnpm typecheck && pnpm build && pnpm test",
    "done": false,
    "tasks": [
      {
        "id": "auth-deps-and-test-setup",
        "description": "apps/content-reviewer/package.json に @supabase/supabase-js, @supabase/ssr, vitest を追加し pnpm install を実行。apps/content-reviewer/vitest.config.ts を作成（src/ 配下のテストを対象、パスエイリアス @/ を設定）。apps/content-reviewer/package.json に test script（vitest run）を追加。ルート package.json に test script（pnpm -r run test）を追加",
        "wave": 1,
        "done": false
      },
      {
        "id": "auth-contracts",
        "description": "auth context と shared context の型定義を作成。src/backend/contexts/shared/domain/models/user-id.model.ts（UserId branded type）、src/backend/contexts/shared/domain/models/email.model.ts（Email 値オブジェクト、バリデーション付き）。src/backend/contexts/auth/domain/models/user.model.ts の interface/型定義（id, email, name, avatarUrl, createdAt, updatedAt）。src/backend/contexts/auth/domain/gateways/auth.gateway.ts（AuthGateway interface: getCurrentUser, signInWithGoogle, signOut, onAuthStateChange）。src/backend/contexts/auth/domain/gateways/user.repository.ts（UserRepository interface: findById, findByEmail, upsert）",
        "wave": 1,
        "done": false
      },
      {
        "id": "supabase-client-init",
        "description": "src/backend/contexts/shared/infrastructure/db/supabase-server-client.ts に Next.js Server Component / Server Action 用の Supabase クライアント生成関数を実装（@supabase/ssr の createServerClient + cookies()）。src/backend/contexts/shared/infrastructure/db/supabase-browser-client.ts にブラウザ用の Supabase クライアント生成関数を実装（@supabase/ssr の createBrowserClient）。src/backend/contexts/shared/infrastructure/db/supabase-middleware-client.ts に middleware 用のクライアント生成関数を実装（NextRequest/NextResponse を受け取り cookie を操作）。環境変数型定義を src/lib/env.ts に作成（NEXT_PUBLIC_SUPABASE_URL, NEXT_PUBLIC_SUPABASE_ANON_KEY）",
        "wave": 2,
        "done": false
      },
      {
        "id": "auth-domain-models",
        "description": "src/backend/contexts/auth/domain/models/user.model.ts に User Rich Domain Model を実装。ファクトリメソッド create(id, email, name, avatarUrl?) でバリデーション実施（Email 値オブジェクト使用）。fromSupabaseUser(supabaseUser) でSupabase Auth ユーザーからの変換。ダミーユーザー生成用の createDummy() static メソッド（開発環境スキップ用、固定 UUID + dummy@example.com）。src/backend/contexts/shared/domain/models/ の UserId, Email 値オブジェクトの実装（ファクトリメソッド + バリデーション）",
        "wave": 2,
        "done": false
      },
      {
        "id": "auth-domain-tests",
        "description": "src/backend/contexts/auth/domain/models/__tests__/user.model.test.ts に User モデルのユニットテスト（create 正常系、バリデーションエラー、createDummy、fromSupabaseUser）。src/backend/contexts/shared/domain/models/__tests__/email.model.test.ts に Email 値オブジェクトのテスト。src/backend/contexts/shared/domain/models/__tests__/user-id.model.test.ts に UserId のテスト。vitest で全テスト pass することを確認",
        "wave": 2,
        "done": false
      },
      {
        "id": "auth-backend-layers",
        "description": "auth context の infrastructure〜presentation 全層を実装。src/backend/contexts/auth/infrastructure/supabase-auth.gateway.ts（AuthGateway の Supabase 実装: getCurrentUser でセッション取得 → User モデル変換、signInWithGoogle で OAuth リダイレクト URL 生成、signOut）。src/backend/contexts/auth/infrastructure/repositories/prisma-user.repository.ts（UserRepository の Prisma 実装: findById, findByEmail, upsert で Prisma User ↔ ドメイン User 変換）。src/backend/contexts/auth/application/usecases/get-current-user.usecase.ts, sign-in.usecase.ts, sign-out.usecase.ts, sync-user.usecase.ts（ログイン後に Supabase auth.users → アプリ users テーブルに同期）。src/backend/contexts/auth/presentation/composition/auth.composition.ts, actions/sign-in.action.ts, actions/sign-out.action.ts, loaders/current-user.loader.ts",
        "wave": 3,
        "done": false
      },
      {
        "id": "auth-middleware-and-callback",
        "description": "apps/content-reviewer/src/middleware.ts を作成。supabase-middleware-client でセッションを検証し、未認証時は /login にリダイレクト。/login, /api/auth/callback, _next/static, _next/image, favicon.ico はスキップ。NODE_ENV=development 時は認証チェックをスキップしダミーユーザーとして通過。src/app/api/auth/callback/route.ts を作成（Supabase SSR の code exchange: URL パラメータの code を exchangeCodeForSession で処理し / にリダイレクト）",
        "wave": 3,
        "done": false
      },
      {
        "id": "login-page-ui",
        "description": "src/app/login/page.tsx を更新し、Google OAuth ログインボタン（shadcn/ui Button）を配置。sign-in.action.ts の Server Action を呼び出して Supabase Auth の Google OAuth フローを開始。ログイン成功後のリダイレクト処理。(app)/layout.tsx にログアウトボタンを追加（ヘッダー右側にユーザー名表示 + ログアウトボタン、current-user.loader.ts でユーザー情報取得、sign-out.action.ts でログアウト実行）",
        "wave": 3,
        "done": false
      },
      {
        "id": "verify-milestone2",
        "description": "pnpm lint && pnpm typecheck && pnpm build && pnpm test を実行し全て成功することを確認。開発環境（NODE_ENV=development）で認証スキップが動作し / にアクセスできることを確認。Biome lint エラー・TypeScript 型エラー・ビルドエラー・テスト失敗があれば全て修正する",
        "wave": 4,
        "done": false
      }
    ]
  },
  {
    "milestone": 3,
    "goal": "/rules ページで表現ルール（NG表現→推奨表現）の一覧表示・新規登録・編集・削除ができ、ExpressionRule ドメインモデル → PrismaExpressionRuleRepository → UseCase（CRUD 4種） → Server Actions → UI の全レイヤーが縦に通って DB に永続化される",
    "verification": "pnpm lint && pnpm typecheck && pnpm build && pnpm test && pnpm exec playwright test",
    "done": false,
    "tasks": []
  },
  {
    "milestone": 4,
    "goal": "/knowledge ページでナレッジ記事の一覧表示・手動登録・編集ができ、保存時に OpenAI Embeddings API で Embedding が自動生成されて pgvector に格納され、KnowledgeArticle / KnowledgeEmbedding ドメインモデル → Repository → UseCase → UI が動作する",
    "verification": "pnpm lint && pnpm typecheck && pnpm build && pnpm test && pnpm exec playwright test",
    "done": false,
    "tasks": []
  },
  {
    "milestone": 5,
    "goal": "/knowledge/import で note アカウント名を入力すると NoteScraperGateway 経由で記事一覧が表示され、選択した記事の本文を取得して DB に保存し Embedding を生成できる",
    "verification": "pnpm lint && pnpm typecheck && pnpm build && pnpm test && pnpm exec playwright test",
    "done": false,
    "tasks": []
  },
  {
    "milestone": 6,
    "goal": "/checks/new でテキストを入力して送信すると、AIGateway による段落分割→5種のチェック（ファクトチェック・ナレッジ整合性・表現ルール適合・炎上リスク・文章クオリティ）が並列実行され、SSE で進捗がリアルタイム表示され、完了後 /checks/[id] で結果詳細（セグメントごとの指摘・severity・修正提案）を確認できる",
    "verification": "pnpm lint && pnpm typecheck && pnpm build && pnpm test && pnpm exec playwright test",
    "done": false,
    "tasks": []
  },
  {
    "milestone": 7,
    "goal": "ダッシュボード（/）に過去のチェック履歴一覧が表示され、ソース種別（Web / Slack）・ステータス・実行日時でフィルタリングでき、各行クリックで /checks/[id] の詳細ページに遷移できる",
    "verification": "pnpm lint && pnpm typecheck && pnpm build && pnpm test && pnpm exec playwright test",
    "done": false,
    "tasks": []
  },
  {
    "milestone": 8,
    "goal": "/api/slack/events で Slack Events API の Webhook を受信し、Slack 署名検証・url_verification 対応の上、@sns-checker メンション時に waitUntil でバックグラウンドチェックを実行し、完了後にスレッドへ結果サマリーと /checks/[id] のパーマリンクを返信できる",
    "verification": "pnpm lint && pnpm typecheck && pnpm build && pnpm test",
    "done": false,
    "tasks": []
  }
]
