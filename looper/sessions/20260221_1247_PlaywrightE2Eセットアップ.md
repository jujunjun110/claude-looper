# playwright-setup: Playwright E2E テストセットアップ

## タスク ID と内容

- ID: `playwright-setup`
- `@playwright/test` を `apps/content-reviewer/package.json` の devDependencies に追加し `pnpm install` を実行
- `playwright.config.ts` を作成（baseURL: http://localhost:3000、webServer で `pnpm dev` 起動、testDir: e2e/）
- `e2e/rules.spec.ts` に `/rules` ページの E2E テストを作成
- ルート `package.json` の scripts に `e2e` script を追加

## 作成・変更したファイル一覧

- `apps/content-reviewer/package.json` — `@playwright/test: ^1.49.0` を devDependencies に追加
- `apps/content-reviewer/playwright.config.ts` — 新規作成
- `apps/content-reviewer/e2e/rules.spec.ts` — 新規作成
- `package.json`（ルート）— `"e2e": "pnpm --filter content-reviewer exec playwright test"` を追加

## 設計判断

- `playwright.config.ts` の `webServer` は `pnpm dev` で Next.js を起動。`reuseExistingServer: !process.env.CI` で開発時は既存サーバーを再利用できる設計
- E2E テストは `/rules` ページの実装（スタブ段階）に対して書いたため、現状は「パスしない」テストとして存在する。/rules ページの UI 実装が進んだ時点でテストが動作するよう、セレクターを柔軟な正規表現で記述
- Biome の lint（シングルクォート、import ソート）に対応するため `lint:fix` で自動修正を適用
- `pnpm verify` は全て通過（lint/typecheck/build/unit test）

## 詰まった点・解決方法

- `pnpm install` がインタラクティブプロンプト（ロックファイル再生成確認）で止まった → `echo "y" | pnpm install` で解決
- Biome が `playwright.config.ts` と `e2e/rules.spec.ts` のフォーマットを指摘 → `pnpm lint:fix` で自動修正

## 次のタスクへの申し送り

- `/rules` ページは現在スタブ（`<h1>表現ルール管理</h1>` のみ）。E2E テストを実際に通すには `expression-rule` context の全層（application/usecase, infrastructure/repository, presentation/action+loader+composition）と `/rules` ページの UI 実装が必要
- E2E テストのセレクターは `getByRole` / `getByLabel` を使った意図ベースの記述になっており、実装時は指定したラベル名・ロールに合わせて UI を実装すれば自然にテストが通る設計
